import requests
import json
from bs4 import BeautifulSoup
import os

def scrape_malware():
    try:
        response = requests.get("https://malpedia.caad.fkie.fraunhofer.de/families")
        if response.status_code == 200:
            soup = BeautifulSoup(response.text, "html.parser")

            find_table = soup.find("table", {"class": "table enumerated table-dark table-sm"})

            data = []

            for row in find_table.find_all("tr"):
                malware_family = row.find('td', class_='common_name')
                threat_actor = row.find('td', class_='actors')
                alt_names = row.find('td', class_='alt_names')
                name = row.find('td', class_='name')

                malware_family_text = malware_family.text if malware_family and malware_family.text else None
                threat_actor_text = threat_actor.text if threat_actor and threat_actor.text else None
                alt_names_text = alt_names.text if alt_names and alt_names.text else None
                name_text = name.text if name and name.text else None
                
                if malware_family_text == '[]':
                    malware_family_text = None
                if threat_actor_text == '[]':
                    threat_actor_text = None
                if alt_names_text == '[]':
                    alt_names_text = None
                if name_text == '[]':
                    name_text = None

                entry = {
                    "Malware Family": malware_family_text,
                    "Threat Actor": threat_actor_text,
                    "Alternate Names": alt_names_text,
                    "Name": name_text
                }

                data.append(entry)

        directory = "Malware Json Files"
        try:
            os.makedirs(directory)
        except FileExistsError:
            pass

        with open(os.path.join(directory, "malware_families.json"), "w") as file:
            json.dump(data, file, indent=4)
    except Exception as e:
        print("Exception:", e)
